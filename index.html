<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Uma Musume S√©lecteur</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: linear-gradient(to bottom right, #fffafc, #ffe6f0); font-family: 'Inter',sans-serif; }
    .uma-card:hover { transform: scale(1.03); transition: transform 0.15s ease; }
    aside, section { height: calc(100vh - 100px); overflow-y:auto; }
    .closeBtn { cursor: pointer; color: #e53e3e; font-weight: bold; }
  </style>
</head>
<body class="min-h-screen flex flex-col">
  <header class="p-4 text-center text-2xl font-bold text-pink-700">
    üêé Uma Musume ‚Äì S√©lecteur
  </header>

  <div id="loginScreen" class="fixed inset-0 bg-white flex items-center justify-center z-50">
    <div class="p-6 bg-white shadow rounded-lg w-80">
      <h2 class="text-xl font-semibold mb-4">Choisissez votre √©quipe</h2>
      <button id="team1Btn" class="w-full mb-2 p-2 bg-pink-500 text-white rounded">√âquipe 1</button>
      <button id="team2Btn" class="w-full mb-4 p-2 bg-pink-500 text-white rounded">√âquipe 2</button>
      <div id="passwordDiv" class="hidden">
        <input type="password" id="teamPassword" placeholder="Mot de passe" class="w-full border p-2 rounded mb-2" />
        <button id="passwordOkBtn" class="w-full p-2 bg-green-500 text-white rounded">Valider</button>
        <p id="passwordError" class="text-red-600 mt-2 hidden">Mot de passe incorrect</p>
      </div>
    </div>
  </div>

  <main class="flex flex-1 hidden" id="mainContent">
    <aside class="w-1/3 bg-white/70 border-r border-pink-200 p-4">
      <h2 class="text-lg font-semibold text-pink-600 mb-3">Liste des Uma</h2>
      <input type="text" id="searchInput" placeholder="Rechercher‚Ä¶" class="mb-4 w-full border border-pink-200 rounded-lg p-2" />
      <div id="umaList" class="grid grid-cols-2 gap-3"></div>
    </aside>

    <section class="flex-1 p-6">
      <h2 class="text-lg font-semibold text-pink-600 mb-3">S√©lection</h2>
      <div class="mb-4">
        <span class="font-medium">Total score : </span>
        <span id="totalScore">0</span> <!-- plus de /max ici -->
      </div>
      <div id="selectedArea" class="grid grid-cols-2 md:grid-cols-3 gap-4"></div>
    </section>
  </main>

  <script>
    const umas = [
      { name: "Special Week", img: "https://gametora.com/images/umamusume/characters/thumb/chara_stand_1001_100101.png", score: 5 },
      { name: "Silence Suzuka", img: "https://gametora.com/images/umamusume/characters/thumb/chara_stand_1002_100201.png", score: 4 },
      // ‚Ä¶ toutes les autres uma ici ‚Ä¶
    ];

    let currentTotal = 0;
    let selectedUmas = [];
    let team = null;

    // Elements
    const loginScreen = document.getElementById("loginScreen");
    const mainContent = document.getElementById("mainContent");
    const team1Btn = document.getElementById("team1Btn");
    const team2Btn = document.getElementById("team2Btn");
    const passwordDiv = document.getElementById("passwordDiv");
    const teamPasswordInput = document.getElementById("teamPassword");
    const passwordOkBtn = document.getElementById("passwordOkBtn");
    const passwordError = document.getElementById("passwordError");

    team1Btn.addEventListener("click", () => startTeamLogin("Equipe 1", "toto"));
    team2Btn.addEventListener("click", () => startTeamLogin("Equipe 2", "toto2"));

    function startTeamLogin(teamName, correctPwd) {
      team = { name: teamName, pwd: correctPwd };
      passwordDiv.classList.remove("hidden");
    }

    passwordOkBtn.addEventListener("click", () => {
      if (teamPasswordInput.value === team.pwd) {
        // connexion ok
        loginScreen.style.display = "none";
        mainContent.classList.remove("hidden");
        loadState();
        renderList();
      } else {
        passwordError.classList.remove("hidden");
      }
    });

    const umaListElem = document.getElementById("umaList");
    const selectedArea = document.getElementById("selectedArea");
    const totalScoreElem = document.getElementById("totalScore");
    const searchInput = document.getElementById("searchInput");

    searchInput.addEventListener("input", () => renderList(searchInput.value));

    function renderList(filter = "") {
      const normFilter = filter.trim().toLowerCase();
      umaListElem.innerHTML = "";
      umas.forEach(uma => {
        if (uma.name.toLowerCase().includes(normFilter)) {
          const card = document.createElement("div");
          card.className = "uma-card bg-white shadow rounded-xl p-2 flex flex-col items-center cursor-pointer hover:shadow-lg";
          card.innerHTML = `
            <img src="${uma.img}" alt="${uma.name}" class="w-20 h-20 object-cover rounded-full mb-2" />
            <p class="text-sm font-medium text-center">${uma.name}</p>
            <p class="text-xs text-gray-500">Score : ${uma.score}</p>
          `;
          card.addEventListener("click", () => addUmaToSelection(uma));
          umaListElem.appendChild(card);
        }
      });
    }

    function addUmaToSelection(uma) {
      // ajout
      selectedUmas.push(uma);
      currentTotal += uma.score;
      updateTotal();
      renderSelected();

      saveState();
    }

    function renderSelected() {
      selectedArea.innerHTML = "";
      selectedUmas.forEach((uma, idx) => {
        const card = document.createElement("div");
        card.className = "bg-white shadow-md rounded-2xl p-3 flex flex-col items-center relative";
        card.innerHTML = `
          <span class="closeBtn absolute top-2 right-2 text-xl">&times;</span>
          <img src="${uma.img}" alt="${uma.name}" class="w-24 h-24 object-cover rounded-full mb-2" />
          <p class="text-sm text-pink-600 font-semibold">${uma.name}</p>
          <p class="text-xs text-gray-500">Score ajout√©: ${uma.score}</p>
          <input type="text" placeholder="Nom personnalis√©‚Ä¶" class="mt-2 w-full border border-pink-200 rounded-lg p-1 text-sm focus:outline-none focus:ring-2 focus:ring-pink-300" />
        `;
        const closeBtn = card.querySelector(".closeBtn");
        closeBtn.addEventListener("click", () => {
          // retirer
          currentTotal -= uma.score;
          selectedUmas.splice(idx, 1);
          updateTotal();
          renderSelected();
          saveState();
        });
        selectedArea.appendChild(card);
      });
    }

    function updateTotal() {
      totalScoreElem.textContent = currentTotal;
    }

    // => Persistance (localStorage)
    function saveState() {
      const state = {
        team: team.name,
        selected: selectedUmas,
        total: currentTotal
      };
      localStorage.setItem("umaSelectorState", JSON.stringify(state));
    }

    function loadState() {
      const raw = localStorage.getItem("umaSelectorState");
      if (!raw) return;
      try {
        const state = JSON.parse(raw);
        if (state.team === team.name) {
          selectedUmas = state.selected || [];
          currentTotal = state.total || 0;
          renderSelected();
          updateTotal();
        }
      } catch(e) {
        console.warn("Erreur chargement √©tat", e);
      }
    }
  </script>
</body>
</html>
